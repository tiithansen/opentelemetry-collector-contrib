# OpenAPI Processor

<!-- status autogenerated section -->
| Status        |           |
| ------------- |-----------|
| Stability     | [alpha]: traces   |
| Distributions | [] |
| Issues        | [![Open issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aopen%20label%3Aprocessor%2Fopenapi%20&label=open&color=orange&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aopen+is%3Aissue+label%3Aprocessor%2Fopenapi) [![Closed issues](https://img.shields.io/github/issues-search/open-telemetry/opentelemetry-collector-contrib?query=is%3Aissue%20is%3Aclosed%20label%3Aprocessor%2Fopenapi%20&label=closed&color=blue&logo=opentelemetry)](https://github.com/open-telemetry/opentelemetry-collector-contrib/issues?q=is%3Aclosed+is%3Aissue+label%3Aprocessor%2Fopenapi) |
| [Code Owners](https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/CONTRIBUTING.md#becoming-a-code-owner)    | [@tiithansen](https://www.github.com/tiithansen) |

[alpha]: https://github.com/open-telemetry/opentelemetry-collector#alpha
<!-- end autogenerated section -->

The OpenAPI processor can be used to add additional data to spans based on the OpenAPI specification. Processor is also able to determine the request route based on the OpenAPI specification from the request target.

## Configuration

All configuration options can be found in [config.go](./config.go) file.

### Available options
- `openapi_specs` (default = []): List of inline OpenAPI specifications.
- `openapi_file_paths` (default = []): List of paths to OpenAPI specification files.
- `openapi_endpoints` (default = []): List of OpenAPI spec endpoints.
- `openapi_directories` (default = []): List of directories containing OpenAPI specification files. See [OpenAPI directory response format](#openapi-directory-response-format) for more information.
- `api_load_timeout` (default = 5s): Timeout for loading OpenAPI specifications.
- `api_reload_interval` (default = 5m): Interval for reloading OpenAPI specifications. If set to 0, specifications will not be reloaded.
- `allow_http_and_https` (default = false): Allow HTTP and HTTPS schemes. If false only the scheme specified in the OpenAPI specification will be allowed.
- `openapi_extensions` (default = []): List of OpenAPI extensions to be added as attributes to span. See [OpenAPI extensions](#openapi-extensions) for more information.

### OpenAPI extensions

OpenAPI processor can extract [OpenAPI extensions](https://swagger.io/docs/specification/openapi-extensions/) from the specification and add them as attributes to the span. Currently only Operation extensions are supported.

## OpenAPI directory response format

The OpenAPI processor can be configured to read OpenAPI specifications from a directory endpoint. The directory endpoint must return a JSON object with an `items` array containing the URLs to the OpenAPI specifications. The following example shows the expected response format:

```json
{
    "items": [
        "https://example.com/openapi.json",
        "https://example.com/openapi2.json"
    ]
}
``` 

### Example

```yaml
processors:
  openapi:
    openapi_specs:
      - name: "example"
        spec: |
          openapi: 3.0.0
          info:
            title: Example API
            version: 1.0.0
          paths:
            /example:
              get:
                operationId: example
                responses:
                  '200':
                    description: OK
    openapi_file_paths:
      - /path/to/openapi.json
    openapi_endpoints:
      - https://example.com/openapi.json
    openapi_directories:
      - https://example.com/openapi-directory.json
    api_load_timeout: 5s
    api_reload_interval: 5m
    allow_http_and_https: false
```
